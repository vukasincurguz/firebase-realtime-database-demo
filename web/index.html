<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Mini Firebase Chat</title>
</head>
<body>
<h2>Mini Chat</h2>

<div id="messages" style="border:1px solid #ccc; padding:10px; width:400px; height:200px; overflow-y:scroll;">
</div>

<input type="text" id="usernameInput" placeholder="Vpiši uporabniško ime..." style="width:150px;">
<input id="msgInput" placeholder="Vpiši sporočilo..." style="width:200px;">
<button id="sendBtn">Pošlji</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, push, onChildAdded }  from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
import { firebaseConfig } from './firebaseConfig.js';

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const chatRef = ref(db, "chat/messages");

const msgBox = document.getElementById("messages");
const input = document.getElementById("msgInput");
const usernameInput = document.getElementById("usernameInput");
const sendBtn = document.getElementById("sendBtn");

// Poslusanje
onChildAdded(chatRef, (data) => {
    const msg = data.val();
    const div = document.createElement("div");
    div.textContent = `[${msg.time}] ${msg.user}: ${msg.text}`;
    msgBox.appendChild(div);
    msgBox.scrollTop = msgBox.scrollHeight;
});

// Posiljanje
sendBtn.onclick = async () => {
    const text = input.value.trim();
    const username = usernameInput.value.trim() || "Anonimni uporabnik";
    if (!text) return;

    try {
        await push(chatRef, {
            text: text,
            time: new Date().toLocaleTimeString(),
            user: username
        });
        input.value = "";
    } catch (e) {
        alert("Napaka pri pošiljanju: " + e.message);
    }
};
</script>

</body>
</html>
